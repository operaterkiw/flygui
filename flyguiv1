local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local mainGui = Instance.new("ScreenGui")
mainGui.Name = "MainGui"
mainGui.ResetOnSpawn = false
mainGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Parent = mainGui
frame.BackgroundColor3 = Color3.fromRGB(163, 255, 137)
frame.BorderColor3 = Color3.fromRGB(103, 221, 213)
frame.Position = UDim2.new(0.1, 0, 0.38, 0)
frame.Size = UDim2.new(0, 190, 0, 57)
frame.Active = true
frame.Draggable = true

-- UI Elements
local function createButton(name, parent, pos, size, color, text, textSize)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Parent = parent
    button.BackgroundColor3 = color
    button.Position = pos
    button.Size = size
    button.Font = Enum.Font.SourceSans
    button.Text = text
    button.TextColor3 = Color3.new(0, 0, 0)
    button.TextSize = textSize or 14
    button.TextWrapped = true
    return button
end

local function createLabel(name, parent, pos, size, color, text)
    local label = Instance.new("TextLabel")
    label.Name = name
    label.Parent = parent
    label.BackgroundColor3 = color
    label.Position = pos
    label.Size = size
    label.Font = Enum.Font.SourceSans
    label.Text = text
    label.TextColor3 = Color3.new(0, 0, 0)
    label.TextScaled = true
    return label
end

local up = createButton("Up", frame, UDim2.new(0, 0, 0, 0), UDim2.new(0, 44, 0, 28), Color3.fromRGB(79, 255, 152), "ขึ้น")
local down = createButton("Down", frame, UDim2.new(0, 0, 0.5, 0), UDim2.new(0, 44, 0, 28), Color3.fromRGB(215, 255, 121), "ลง")
local onoff = createButton("OnOff", frame, UDim2.new(0.7, 0, 0.5, 0), UDim2.new(0, 56, 0, 28), Color3.fromRGB(255, 249, 74), "บิน")
local plus = createButton("Plus", frame, UDim2.new(0.23, 0, 0, 0), UDim2.new(0, 45, 0, 28), Color3.fromRGB(133, 145, 255), "+")
local minus = createButton("Minus", frame, UDim2.new(0.23, 0, 0.5, 0), UDim2.new(0, 45, 0, 28), Color3.fromRGB(123, 255, 247), "-")
local closeButton = createButton("Close", frame, UDim2.new(0, 0, -1, 27), UDim2.new(0, 45, 0, 28), Color3.fromRGB(225, 25, 0), "ปิด", 24)
local minimize = createButton("Minimize", frame, UDim2.new(0, 44, -1, 27), UDim2.new(0, 45, 0, 28), Color3.fromRGB(192, 150, 230), "-", 30)
local minimize2 = createButton("Minimize2", frame, UDim2.new(0, 44, -1, 57), UDim2.new(0, 45, 0, 28), Color3.fromRGB(192, 150, 230), "+", 30)
minimize2.Visible = false

local titleLabel = createLabel("Title", frame, UDim2.new(0.47, 0, 0, 0), UDim2.new(0, 100, 0, 28), Color3.fromRGB(242, 60, 255), "สคริปต์บิน By:คิว")
local speedLabel = createLabel("SpeedLabel", frame, UDim2.new(0.47, 0, 0.5, 0), UDim2.new(0, 44, 0, 28), Color3.fromRGB(255, 85, 0), "1")

-- Variables
local flying = false
local flightSpeed = 1
local upConnection
local downConnection

StarterGui:SetCore("SendNotification", {
    Title = "สคริปต์บิน By: คิว",
    Text = "By kew_nk",
    Icon = "rbxthumb://type=Asset&id=5107182114&w=150&h=150",
    Duration = 5
})

-- Flying Function
local function toggleFly()
    flying = not flying

    local humanoid = character:FindFirstChildWhichIsA("Humanoid")
    if not humanoid then return end

    if flying then
        humanoid.PlatformStand = true
        local bodyGyro = Instance.new("BodyGyro", character:WaitForChild("HumanoidRootPart"))
        bodyGyro.P = 9e4
        bodyGyro.maxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.cframe = workspace.CurrentCamera.CFrame

        local bodyVelocity = Instance.new("BodyVelocity", character:WaitForChild("HumanoidRootPart"))
        bodyVelocity.velocity = Vector3.new(0, 0.1, 0)
        bodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)

        RunService.RenderStepped:Connect(function()
            if not flying then
                bodyGyro:Destroy()
                bodyVelocity:Destroy()
                humanoid.PlatformStand = false
                return
            end

            bodyGyro.CFrame = workspace.CurrentCamera.CFrame
            local moveDir = humanoid.MoveDirection
            bodyVelocity.Velocity = moveDir * (flightSpeed * 5)
        end)
    else
        humanoid.PlatformStand = false
    end
end

-- Button Functions
onoff.MouseButton1Click:Connect(toggleFly)

plus.MouseButton1Click:Connect(function()
    flightSpeed = flightSpeed + 1
    speedLabel.Text = tostring(flightSpeed)
end)

minus.MouseButton1Click:Connect(function()
    flightSpeed = math.max(1, flightSpeed - 1)
    speedLabel.Text = tostring(flightSpeed)
end)

closeButton.MouseButton1Click:Connect(function()
    mainGui:Destroy()
end)

minimize.MouseButton1Click:Connect(function()
    frame.Visible = false
    minimize2.Visible = true
end)

minimize2.MouseButton1Click:Connect(function()
    frame.Visible = true
    minimize2.Visible = false
end)

up.MouseButton1Down:Connect(function()
    upConnection = RunService.Heartbeat:Connect(function()
        character:WaitForChild("HumanoidRootPart").CFrame = character.HumanoidRootPart.CFrame * CFrame.new(0, 1, 0)
    end)
end)

up.MouseButton1Up:Connect(function()
    if upConnection then
        upConnection:Disconnect()
        upConnection = nil
    end
end)

down.MouseButton1Down:Connect(function()
    downConnection = RunService.Heartbeat:Connect(function()
        character:WaitForChild("HumanoidRootPart").CFrame = character.HumanoidRootPart.CFrame * CFrame.new(0, -1, 0)
    end)
end)

down.MouseButton1Up:Connect(function()
    if downConnection then
        downConnection:Disconnect()
        downConnection = nil
    end
end)

-- Reset things when respawn
player.CharacterAdded:Connect(function(char)
    character = char
    wait(1)
end)
